(function(){let elUploadBox=document.getElementById('upload-box');let elImageEditorMain=document.querySelector('.image-editor-main');let elImageEditorRight=document.querySelector('.image-editor-right');let elLoading=document.querySelector('.loading');let elBtnConvert=document.getElementById('btn-convert');let elOptionWidth=document.getElementById('option-width');let elOptionHeight=document.getElementById('option-height');let elOptionAspectRatio=document.getElementById('option-aspect-ratio');let originWidth=0;let originHeight=0;elOptionWidth.addEventListener('change',e=>{let newWidth=parseInt(elOptionWidth.value);if(originWidth==newWidth){return;}
if(elOptionAspectRatio.checked){if(newWidth<=0){elOptionHeight.value=0;return;}
let ratio=originHeight/originWidth;let _width=newWidth-originWidth;let _height=Math.round(_width*ratio);elOptionHeight.value=originHeight+_height;}});elOptionHeight.addEventListener('change',e=>{let newHeight=parseInt(elOptionHeight.value);if(originHeight==newHeight){return;}
if(elOptionAspectRatio.checked){if(newHeight<=0){elOptionWidth.value=0;return;}
let ratio=originWidth/originHeight;let _height=newHeight-originHeight;let _width=Math.floor(_height*ratio);elOptionWidth.value=originWidth+_width;}});const image=new ImageEditor('#upload-drop',{upload:{maxFiles:1,addRemoveLinks:false,clickable:['#btn-addfiles']}});image.initUpload();image.uploadHandler.on('addedfile',file=>{setTimeout(()=>{if(!file.accepted){image.uploadHandler.removeFile(file);return;}
elUploadBox.classList.add('d-none');elImageEditorMain.classList.remove('d-none');elImageEditorRight.classList.remove('d-none');},1);});image.uploadHandler.on('thumbnail',file=>{if(!file.accepted){return;}
elOptionWidth.value=originWidth=file.width;elOptionHeight.value=originHeight=file.height;});elBtnConvert.addEventListener('click',e=>{let files=image.uploadHandler.getAcceptedFiles();if(files.length==0){return;}
elLoading.classList.remove('d-none');elImageEditorMain.classList.add('d-none');elImageEditorRight.classList.add('d-none');image.resize(files[0],{width:parseInt(elOptionWidth.value),height:parseInt(elOptionHeight.value)}).then(file=>{const webDB=new WebDB();webDB.open().then(()=>{webDB.update({id:1,type:'resized',name:fileNameAppend(files[0].name,'_resized'),data:file},e=>{toDownload(navActive);});});}).catch(err=>{console.log(err.message);});});})();